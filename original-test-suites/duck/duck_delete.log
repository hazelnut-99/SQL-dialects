CREATE TABLE a(i INTEGER);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
INSERT INTO a SELECT * FROM range(0, 1024, 1);
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=0;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1022;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1023;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=0;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1022;
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a WHERE i=1023;
SELECT COUNT(*) FROM a;
SELECT COUNT(*) FROM a;
COMMIT;
COMMIT;
COMMIT;
COMMIT;
SELECT COUNT(*) FROM a;
PRAGMA enable_verification;
CREATE TABLE a(i INTEGER);
INSERT INTO a VALUES (1), (2), (3);
DELETE FROM a USING (values (1)) tbl(i) WHERE a.i=tbl.i;
SELECT * FROM a;
DELETE FROM a USING (values (1)) tbl(i);
SELECT * FROM a;
INSERT INTO a VALUES (1), (2), (3);
SELECT * FROM a;
DELETE FROM a USING (values (1)) tbl(i), (values (1), (2)) tbl2(i) WHERE a.i=tbl.i AND a.i=tbl2.i;
SELECT * FROM a;
DELETE FROM a USING (values (4)) tbl(i) WHERE a.i=tbl.i;
SELECT * FROM a;
DELETE FROM a USING a a2(i) WHERE a.i>a2.i;
SELECT * FROM a;
DELETE FROM a USING b WHERE a.i=b.i;
DELETE FROM a USING a b WHERE a.i=b.j;
PRAGMA enable_verification;
CREATE TABLE a(i INTEGER);
INSERT INTO a VALUES (42);
TRUNCATE TABLE a;
TRUNCATE a;
SELECT COUNT(*) FROM a;
INSERT INTO a VALUES (42);
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
TRUNCATE a;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
PRAGMA enable_verification;
CREATE TABLE a AS SELECT * FROM range(0, 10000, 1) t1(i);
SELECT COUNT(*) FROM a WHERE i >= 2000 AND i < 5000;
DELETE FROM a WHERE i >= 2000 AND i < 5000;
SELECT COUNT(*) FROM a;
pragma threads=2;
pragma verify_parallelism;
CREATE TABLE a AS SELECT * FROM range(0, 10000, 1) t1(i);
SELECT COUNT(*) FROM a;
DELETE FROM a WHERE i >= 2000 AND i < 5000;
SELECT COUNT(*) FROM a;
create table integers as select * from generate_series(0, 9, 1);
create table integers2 as select * from generate_series(0, 9, 1);
DELETE FROM integers USING integers2;
SELECT COUNT(*) FROM integers;
DROP TABLE integers;
DROP TABLE integers2;
BEGIN transaction;
create table integers as select * from generate_series(0, 9, 1);
create table integers2 as select * from generate_series(0, 9, 1);
DELETE FROM integers USING integers2;
SELECT COUNT(*) FROM integers;
COMMIT;
SELECT COUNT(*) FROM integers;
PRAGMA enable_verification;
CREATE TABLE aggr (k int[]);
INSERT INTO aggr VALUES ([0, 1, 1, 1, 4, 0, 3, 3, 2, 2, 4, 4, 2, 4, 0, 0, 0, 1, 2, 3, 4, 2, 3, 3, 1]);
INSERT INTO aggr VALUES ([]), ([NULL]), (NULL), ([0, 1, 1, 1, 4, NULL, 0, 3, 3, 2, NULL, 2, 4, 4, 2, 4, 0, 0, 0, 1, NULL, 2, 3, 4, 2, 3, 3, 1]);
SELECT COUNT(k) FROM aggr;
DELETE FROM aggr;
SELECT COUNT(k) FROM aggr;
PRAGMA enable_verification;
CREATE TABLE a(i INTEGER);
INSERT INTO a VALUES (42);
SELECT COUNT(*) FROM a;
DELETE FROM a;
SELECT COUNT(*) FROM a;
INSERT INTO a VALUES (42);
SELECT COUNT(*) FROM a;
BEGIN TRANSACTION;
DELETE FROM a;
SELECT COUNT(*) FROM a;
ROLLBACK;
SELECT COUNT(*) FROM a;
CREATE TABLE integers AS FROM range(4) t(i);
DELETE FROM integers WHERE i%2=0;
SELECT COUNT(*) FROM integers;
CREATE TABLE integers2(i int);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (0);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (1);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (2);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (3);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (4);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (5);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (6);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (7);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (8);
SELECT COUNT(*) FROM integers;
INSERT INTO integers2 VALUES (9);
CREATE TABLE test (i INTEGER);
INSERT INTO test SELECT * FROM generate_series(0, 999);
DELETE FROM test WHERE i%2=0;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
INSERT INTO test SELECT * FROM generate_series(1000, 1099);
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
DELETE FROM test WHERE i%3=0;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
INSERT INTO test SELECT * FROM generate_series(1000, 1999);
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
SELECT COUNT(*) FROM test WHERE i%7=0;
DELETE FROM test WHERE i%7=0;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
DELETE FROM test WHERE i%3=0;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
INSERT INTO test SELECT 1 FROM generate_series(0, 4000);
INSERT INTO test SELECT 2 FROM generate_series(0, 4000);
DELETE FROM test WHERE i=1;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
DELETE FROM test WHERE i=2;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
DELETE FROM test;
SELECT COUNT(*), SUM(i), MIN(i), MAX(i) FROM test;
CREATE TABLE integers AS SELECT * FROM range(0, 10000000) t(i);
DELETE FROM integers WHERE i % 2 = 0;
SELECT COUNT(*) FROM integers;
SELECT COUNT(*) * get_block_size('drop_many_deletes') <= 262144 FROM pragma_metadata_info();
DROP TABLE integers;
SELECT COUNT(*) * get_block_size('drop_many_deletes') <= 262144 FROM pragma_metadata_info();
CREATE TABLE integers AS SELECT * FROM generate_series(0,599999) t(i);
DELETE FROM integers WHERE i%2=0;
SELECT COUNT(*) FROM integers;
INSERT INTO integers VALUES (42);
SELECT COUNT(*) FROM integers;
SELECT COUNT(*) FROM integers;
DELETE FROM integers WHERE i%3=0;
SELECT COUNT(*) FROM integers;
SELECT COUNT(*) FROM integers;
INSERT INTO integers VALUES (84);
checkpoint;
SELECT COUNT(*) - 0 FROM integers;
SELECT COUNT(*) - 0 FROM integers;
INSERT INTO integers VALUES (84);
checkpoint;
SELECT COUNT(*) - 1 FROM integers;
SELECT COUNT(*) - 1 FROM integers;
INSERT INTO integers VALUES (84);
checkpoint;
SELECT COUNT(*) - 2 FROM integers;
SELECT COUNT(*) - 2 FROM integers;
INSERT INTO integers VALUES (84);
checkpoint;
SELECT COUNT(*) - 3 FROM integers;
SELECT COUNT(*) - 3 FROM integers;
INSERT INTO integers VALUES (84);
checkpoint;
SELECT COUNT(*) - 4 FROM integers;
SELECT COUNT(*) - 4 FROM integers;
BEGIN TRANSACTION;
CREATE TABLE test (a INTEGER, b INTEGER);
INSERT INTO test VALUES (11, 22), (12, 21), (13, 22), (12, 21);
DELETE FROM test WHERE a=12;
SELECT a, b FROM test ORDER BY a;
COMMIT;
CHECKPOINT;
SELECT a, b FROM test ORDER BY a;
DELETE FROM test WHERE a=11;
SELECT a, b FROM test ORDER BY a;
INSERT INTO test VALUES (11, 24), (12, 25);
SELECT a, b FROM test ORDER BY a;
DELETE FROM test WHERE a=12;
SELECT a, b FROM test ORDER BY a;
CHECKPOINT;
SELECT a, b FROM test ORDER BY a;
CREATE TABLE integers AS SELECT * FROM generate_series(0,599999) t(i);
DELETE FROM integers WHERE i%2=0;
ALTER TABLE integers ADD COLUMN k INTEGER;
SELECT COUNT(*), COUNT(i), COUNT(k) FROM integers;
UPDATE integers SET k=i+1;
SELECT COUNT(*), COUNT(i), COUNT(k), SUM(k) - SUM(i) FROM integers;
DELETE FROM integers WHERE i%3=0;
SELECT COUNT(*), COUNT(i), COUNT(k), SUM(k) - SUM(i) FROM integers;
BEGIN TRANSACTION;
CREATE TABLE test (a INTEGER, b INTEGER);
INSERT INTO test SELECT i, i+2 FROM range(0, 1000000) t(i);
SELECT COUNT(*) FROM test;
DELETE FROM test WHERE a=2;
SELECT COUNT(*) FROM test;
COMMIT;
SELECT COUNT(*) FROM test;
INSERT INTO test VALUES (2, 4);
SELECT COUNT(*) FROM test;
DELETE FROM test WHERE a%2=0;
SELECT COUNT(*) FROM test;
