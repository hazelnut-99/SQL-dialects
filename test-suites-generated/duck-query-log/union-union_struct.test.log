CREATE TABLE tbl1 (union_struct UNION(str VARCHAR, obj STRUCT(k VARCHAR, v INT)))
INSERT INTO tbl1 VALUES 
    ({'k': 'key1', 'v': 1}), 
    ('not a struct'), 
    (NULL), 
    ({'k': NULL, 'v': 1}),
    ({'k': 'key2', 'v': NULL}),
    ('key2')
SELECT * FROM tbl1
SELECT union_struct.obj.k FROM tbl1
SELECT union_struct.obj.v FROM tbl1
SELECT union_struct.str FROM tbl1
SELECT * FROM tbl1 as l JOIN tbl1 as r ON l.union_struct.str = r.union_struct.obj.k
CREATE TABLE tbl2 (struct_union STRUCT(str VARCHAR, alt UNION(k VARCHAR, v INT)))
INSERT INTO tbl2 VALUES 
    ({'str': 'key1', 'alt': 1}), 
    ({'str': 'key2', 'alt': 'key2'}), 
    ({'str': NULL, 'alt': NULL}), 
    ({'str': NULL, 'alt': union_value(v := NULL)}),
    ({'str': 'key3', 'alt': union_value(k := NULL)}),
    ({'str': 'key4', 'alt': 'key2'})
SELECT * FROM tbl2
SELECT * FROM tbl1 JOIN tbl2 ON tbl1.union_struct.str = tbl2.struct_union.alt.k order by all
