PRAGMA enable_verification;
SELECT COUNT(DISTINCT 42) OVER ();
SELECT COUNT(DISTINCT 42) OVER ();
;
SELECT COUNT(DISTINCT 42) OVER ();
SELECT count(DISTINCT 42) OVER ();
;
;
;
;
SELECT COUNT(DISTINCT 42) OVER ();
WITH t AS (
	SELECT col0 AS a, col1 AS b 
	FROM (VALUES
		(1,2),
		(1,1),
		(1,2),
		(2,1),
		(2,1),
		(2,2),
		(2,3),
		(2,4)
	) v) 
SELECT *, COUNT(b) OVER(PARTITION BY a), COUNT(DISTINCT b) OVER(PARTITION BY a) 
FROM t
ORDER BY 1, 2;
WITH t AS (
	SELECT col0 AS a, col1 AS b 
	FROM (VALUES
		(1,2),
		(1,1),
		(1,2),
		(2,1),
		(2,1),
		(2,2),
		(2,3),
		(2,4)
	) v) 
SELECT *, COUNT(b) OVER(PARTITION BY a), COUNT(DISTINCT b) OVER(PARTITION BY a) 
FROM t
ORDER BY 1, 2;
;
WITH t AS (
	SELECT col0 AS a, col1 AS b 
	FROM (VALUES
		(1,2),
		(1,1),
		(1,2),
		(2,1),
		(2,1),
		(2,2),
		(2,3),
		(2,4)
	) v) 
SELECT *, COUNT(b) OVER(PARTITION BY a), COUNT(DISTINCT b) OVER(PARTITION BY a) 
FROM t
ORDER BY 1, 2;
WITH t AS (SELECT col0 AS a, col1 AS b FROM (SELECT * FROM (VALUES (1, 2), (1, 1), (1, 2), (2, 1), (2, 1), (2, 2), (2, 3), (2, 4)) AS valueslist) AS v)SELECT *, count(b) OVER (PARTITION BY a), count(DISTINCT b) OVER (PARTITION BY a) FROM t ORDER BY 1, 2;
;
;
;
;
WITH t AS (
	SELECT col0 AS a, col1 AS b 
	FROM (VALUES
		(1,2),
		(1,1),
		(1,2),
		(2,1),
		(2,1),
		(2,2),
		(2,3),
		(2,4)
	) v) 
SELECT *, COUNT(b) OVER(PARTITION BY a), COUNT(DISTINCT b) OVER(PARTITION BY a) 
FROM t
ORDER BY 1, 2;
CREATE TABLE figure1 AS 
	SELECT * 
	FROM VALUES 
			(1, 'a'),
			(2, 'b'),
			(3, 'b'),
			(4, 'c'),
			(5, 'c'),
			(6, 'b'),
			(7, 'c'),
			(8, 'a')
		v(i, s);;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
SELECT i, s, count(DISTINCT s) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM figure1 ORDER BY i;
;
;
;
;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
WITH uncascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(1000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM uncascaded
ORDER BY i;
WITH uncascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(1000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM uncascaded
ORDER BY i;
;
WITH uncascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(1000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM uncascaded
ORDER BY i;
WITH uncascaded AS (SELECT i, (i % 29) AS v FROM range(1000) AS tbl(i))SELECT i, v, count(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w FROM uncascaded ORDER BY i;
;
;
;
;
WITH uncascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(1000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM uncascaded
ORDER BY i;
WITH cascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(10000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM cascaded
ORDER BY i;
WITH cascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(10000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM cascaded
ORDER BY i;
;
WITH cascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(10000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM cascaded
ORDER BY i;
WITH "cascaded" AS (SELECT i, (i % 29) AS v FROM range(10000) AS tbl(i))SELECT i, v, count(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w FROM "cascaded" ORDER BY i;
;
;
;
;
WITH cascaded AS (
	SELECT i, i % 29 AS v 
	FROM range(10000) tbl(i)
)
SELECT i
	, v
	, COUNT(DISTINCT v) OVER (ORDER BY i ROWS BETWEEN 25 PRECEDING AND 25 FOLLOWING) AS w
FROM cascaded
ORDER BY i;
SELECT i
	, s
	, i // 2 AS o
	, COUNT(DISTINCT s) OVER(
		ORDER BY i // 2
		ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING 
		EXCLUDE TIES
	) AS c
FROM figure1
ORDER BY i;
SELECT i
	, s
	, i // 2 AS o
	, COUNT(DISTINCT s) OVER(
		ORDER BY i // 2
		ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING 
		EXCLUDE TIES
	) AS c
FROM figure1
ORDER BY i;
;
SELECT i
	, s
	, i // 2 AS o
	, COUNT(DISTINCT s) OVER(
		ORDER BY i // 2
		ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING 
		EXCLUDE TIES
	) AS c
FROM figure1
ORDER BY i;
SELECT i, s, (i // 2) AS o, count(DISTINCT s) OVER (ORDER BY (i // 2) ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING EXCLUDE TIES) AS c FROM figure1 ORDER BY i;
;
;
;
;
SELECT i
	, s
	, i // 2 AS o
	, COUNT(DISTINCT s) OVER(
		ORDER BY i // 2
		ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING 
		EXCLUDE TIES
	) AS c
FROM figure1
ORDER BY i;
INSERT INTO figure1 VALUES 
	(9, NULL),
	(NULL, 'b'),
	(NULL, NULL),
;;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
SELECT i, s, count(DISTINCT s) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM figure1 ORDER BY i;
;
;
;
;
SELECT i
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM figure1
ORDER BY i;
CREATE TABLE nested AS
	SELECT 
		i, 
		s, 
		{"m": i % 2, "s": s} AS n,
		[(i % 2)::VARCHAR, s] AS l,
		i * i AS r
	FROM figure1;
SELECT i
	, n
	, COUNT(DISTINCT n) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, n
	, COUNT(DISTINCT n) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, n
	, COUNT(DISTINCT n) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, n, count(DISTINCT n) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, n
	, COUNT(DISTINCT n) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, l
	, COUNT(DISTINCT l) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, l
	, COUNT(DISTINCT l) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, l
	, COUNT(DISTINCT l) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, l, count(DISTINCT l) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, l
	, COUNT(DISTINCT l) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT r
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY r RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT r
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY r RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT r
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY r RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT r, s, count(DISTINCT s) OVER (ORDER BY r RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT r
	, s
	, COUNT(DISTINCT s) OVER( ORDER BY r RANGE BETWEEN 10 PRECEDING AND 10 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, STRING_AGG(DISTINCT s, ', ') OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, STRING_AGG(DISTINCT s, ', ') OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, s
	, STRING_AGG(DISTINCT s, ', ') OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, s, string_agg(DISTINCT s, ', ') OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, s
	, STRING_AGG(DISTINCT s, ', ') OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, MEDIAN(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, MEDIAN(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, s
	, MEDIAN(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, s, median(DISTINCT s) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, s
	, MEDIAN(DISTINCT s) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 0) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 0) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 0) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, s, count(DISTINCT s) FILTER (WHERE ((i % 3) = 0)) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 0) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 1) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 1) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 1) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, s, count(DISTINCT s) FILTER (WHERE ((i % 3) = 1)) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 1) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 2) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 2) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 2) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
SELECT i, s, count(DISTINCT s) FILTER (WHERE ((i % 3) = 2)) OVER (ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c FROM nested ORDER BY i;
;
;
;
;
SELECT i
	, s
	, COUNT(DISTINCT s) FILTER (WHERE i % 3 = 2) OVER( ORDER BY i ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS c
FROM nested
ORDER BY i;
