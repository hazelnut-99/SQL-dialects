pragma enable_verification;;
SET preserve_insertion_order=false;;
CREATE TABLE integers(
	i INTEGER unique,
	j INTEGER DEFAULT 0,
	k INTEGER DEFAULT 0
);;
INSERT INTO integers(i) SELECT i from range(5000) tbl(i);;
SELECT COUNT(*) FROM integers;
SELECT COUNT(*) FROM integers;
;
SELECT COUNT(*) FROM integers;
SELECT count_star() FROM integers;
;
;
;
;
SELECT COUNT(*) FROM integers;
INSERT INTO integers SELECT * FROM integers on conflict do nothing;;
INSERT INTO integers SELECT * FROM integers on conflict do update set j = 10;;
SELECT COUNT(*) FILTER (WHERE j = 10) FROM integers;
SELECT COUNT(*) FILTER (WHERE j = 10) FROM integers;
;
SELECT COUNT(*) FILTER (WHERE j = 10) FROM integers;
SELECT count_star() FILTER (WHERE (j = 10)) FROM integers;
;
;
;
;
SELECT COUNT(*) FILTER (WHERE j = 10) FROM integers;
INSERT INTO integers(i,j) select i%5,i from range(5000) tbl(i) on conflict do update set j = excluded.j, k = excluded.i;;
INSERT INTO integers(i,j) select i%5,i from range(4995, 5000) tbl(i) on conflict do update set j = excluded.j, k = excluded.i;;
select j from integers limit 5;;
select j from integers limit 5;;
;
select j from integers limit 5;;
SELECT j FROM integers LIMIT 5;
;
;
;
;
select j from integers limit 5;;
insert into integers(i,j)
	select
		CASE WHEN i % 2 = 0
			THEN
				4999 - (i//2)
			ELSE
				i - ((i//2)+1)
		END,
		i
	from range(5000) tbl(i)
on conflict do update set j = excluded.j;;
select j from integers limit 5;;
select j from integers limit 5;;
;
select j from integers limit 5;;
SELECT j FROM integers LIMIT 5;
;
;
;
;
select j from integers limit 5;;
select j from integers limit 5 offset 4995;;
select j from integers limit 5 offset 4995;;
;
select j from integers limit 5 offset 4995;;
SELECT j FROM integers LIMIT 5 OFFSET 4995;
;
;
;
;
select j from integers limit 5 offset 4995;;
update integers set j = 0;;
insert into integers(i,j)
	select
		CASE WHEN i % 2 = 0
			THEN
				4999 - (i//2)
			ELSE
				i - ((i//2)+1)
		END,
		i
	from range(5000) tbl(i)
on conflict do update set j = excluded.j where i % 2 = 0 AND excluded.j % 2 = 0;;
select COUNT(j) filter (where j != 0) from integers;;
select COUNT(j) filter (where j != 0) from integers;;
;
select COUNT(j) filter (where j != 0) from integers;;
SELECT count(j) FILTER (WHERE (j != 0)) FROM integers;
;
;
;
;
select COUNT(j) filter (where j != 0) from integers;;
