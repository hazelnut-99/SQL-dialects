PRAGMA enable_verification;
select s1, s2, sm
from generate_series(1, 3) s1(s1),
     lateral (select s2, sum(s1 + s2) sm
              from generate_series(1, 3) s2(s2) group by s2) ss
order by 1, 2;;
select s1, s2, sm
from generate_series(1, 3) s1(s1),
     lateral (select s2, sum(s1 + s2) sm
              from generate_series(1, 3) s2(s2) group by s2) ss
order by 1, 2;;
;
select s1, s2, sm
from generate_series(1, 3) s1(s1),
     lateral (select s2, sum(s1 + s2) sm
              from generate_series(1, 3) s2(s2) group by s2) ss
order by 1, 2;;
SELECT s1, s2, sm FROM generate_series(1, 3) AS s1(s1) , (SELECT s2, sum((s1 + s2)) AS sm FROM generate_series(1, 3) AS s2(s2) GROUP BY s2) AS ss ORDER BY 1, 2;
;
;
;
;
select s1, s2, sm
from generate_series(1, 3) s1(s1),
     lateral (select s2, sum(s1 + s2) sm
              from generate_series(1, 3) s2(s2) group by s2) ss
order by 1, 2;;
create table agg_data_1k as select g*10 AS g from generate_series(0, 999) g(g);;
select * from
  (values (100), (300), (500)) as r(a),
  lateral (
    select (g/2)::int as c1,
           array_agg(g::int) as c2,
	   count(*) as c3
    from agg_data_1k
    where g < r.a
    group by g/2) as s
order by 1, 2, 4, 3;;
select * from
  (values (100), (300), (500)) as r(a),
  lateral (
    select (g/2)::int as c1,
           array_agg(g::int) as c2,
	   count(*) as c3
    from agg_data_1k
    where g < r.a
    group by g/2) as s
order by 1, 2, 4, 3;;
;
select * from
  (values (100), (300), (500)) as r(a),
  lateral (
    select (g/2)::int as c1,
           array_agg(g::int) as c2,
	   count(*) as c3
    from agg_data_1k
    where g < r.a
    group by g/2) as s
order by 1, 2, 4, 3;;
SELECT * FROM (SELECT * FROM (VALUES (100), (300), (500)) AS valueslist) AS r(a) , (SELECT CAST((g / 2) AS INTEGER) AS c1, array_agg(CAST(g AS INTEGER)) AS c2, count_star() AS c3 FROM agg_data_1k WHERE (g < r.a) GROUP BY (g / 2)) AS s ORDER BY 1, 2, 4, 3;
;
;
;
;
select * from
  (values (100), (300), (500)) as r(a),
  lateral (
    select (g/2)::int as c1,
           array_agg(g::int) as c2,
	   count(*) as c3
    from agg_data_1k
    where g < r.a
    group by g/2) as s
order by 1, 2, 4, 3;;
CREATE TABLE INT2_TBL(f1 int2);;
INSERT INTO INT2_TBL(f1) VALUES
  ('0   '),
  ('  1234 '),
  ('    -1234'),
  ('32767'),  -- largest and smallest values
  ('-32767');;
CREATE TABLE INT4_TBL(f1 int4);;
INSERT INTO INT4_TBL(f1) VALUES
  ('   0  '),
  ('123456     '),
  ('    -123456'),
  ('2147483647'),  -- largest and smallest values
  ('-2147483647');;
CREATE TABLE INT8_TBL(q1 int8, q2 int8);;
INSERT INTO INT8_TBL VALUES
  ('  123   ','  456'),
  ('123   ','4567890123456789'),
  ('4567890123456789','123'),
  (+4567890123456789,'4567890123456789'),
  ('+4567890123456789','-4567890123456789');;
CREATE TABLE TEXT_TBL (f1 text);;
INSERT INTO TEXT_TBL VALUES
  ('doh!'),
  ('hi de ho neighbor');;
CREATE TABLE tenk1 (
	unique1		int4,
	unique2		int4,
	two			int4,
	four		int4,
	ten			int4,
	twenty		int4,
	hundred		int4,
	thousand	int4,
	twothousand	int4,
	fivethous	int4,
	tenthous	int4,
	odd			int4,
	even		int4,
	stringu1	varchar,
	stringu2	varchar,
	string4		varchar
);;
COPY tenk1 FROM 'data/csv/tenk.tsv.gz' (DELIMITER '\t');
select * from
  int4_tbl as i41,
  lateral
    (select 1 as x from
      (select i41.f1 as lat,
              i42.f1 as loc from
         int8_tbl as i81, int4_tbl as i42) as ss1
      right join int4_tbl as i43 on (i43.f1 > 1)
      where ss1.loc = ss1.lat) as ss2
where i41.f1 > 0;;
select * from
  int4_tbl as i41,
  lateral
    (select 1 as x from
      (select i41.f1 as lat,
              i42.f1 as loc from
         int8_tbl as i81, int4_tbl as i42) as ss1
      right join int4_tbl as i43 on (i43.f1 > 1)
      where ss1.loc = ss1.lat) as ss2
where i41.f1 > 0;;
;
select * from
  int4_tbl as i41,
  lateral
    (select 1 as x from
      (select i41.f1 as lat,
              i42.f1 as loc from
         int8_tbl as i81, int4_tbl as i42) as ss1
      right join int4_tbl as i43 on (i43.f1 > 1)
      where ss1.loc = ss1.lat) as ss2
where i41.f1 > 0;;
SELECT * FROM int4_tbl AS i41 , (SELECT 1 AS x FROM (SELECT i41.f1 AS lat, i42.f1 AS loc FROM int8_tbl AS i81 , int4_tbl AS i42) AS ss1 RIGHT JOIN int4_tbl AS i43 ON ((i43.f1 > 1)) WHERE (ss1.loc = ss1.lat)) AS ss2 WHERE (i41.f1 > 0);
;
;
;
;
select * from
  int4_tbl as i41,
  lateral
    (select 1 as x from
      (select i41.f1 as lat,
              i42.f1 as loc from
         int8_tbl as i81, int4_tbl as i42) as ss1
      right join int4_tbl as i43 on (i43.f1 > 1)
      where ss1.loc = ss1.lat) as ss2
where i41.f1 > 0;;
select ss1.d1 from
  tenk1 as t1
  inner join tenk1 as t2
  on t1.tenthous = t2.ten
  inner join
    int8_tbl as i8
    left join int4_tbl as i4
      inner join (select 64 as d1
                  from tenk1 t3,
                       lateral (select abs(t3.unique1) + random()) ss0(x)
                  where t3.fivethous < 0) as ss1
      on i4.f1 = ss1.d1
    on i8.q1 = i4.f1
  on t1.tenthous = ss1.d1
where t1.unique1 < i4.f1;;
select ss1.d1 from
  tenk1 as t1
  inner join tenk1 as t2
  on t1.tenthous = t2.ten
  inner join
    int8_tbl as i8
    left join int4_tbl as i4
      inner join (select 64 as d1
                  from tenk1 t3,
                       lateral (select abs(t3.unique1) + random()) ss0(x)
                  where t3.fivethous < 0) as ss1
      on i4.f1 = ss1.d1
    on i8.q1 = i4.f1
  on t1.tenthous = ss1.d1
where t1.unique1 < i4.f1;;
;
select ss1.d1 from
  tenk1 as t1
  inner join tenk1 as t2
  on t1.tenthous = t2.ten
  inner join
    int8_tbl as i8
    left join int4_tbl as i4
      inner join (select 64 as d1
                  from tenk1 t3,
                       lateral (select abs(t3.unique1) + random()) ss0(x)
                  where t3.fivethous < 0) as ss1
      on i4.f1 = ss1.d1
    on i8.q1 = i4.f1
  on t1.tenthous = ss1.d1
where t1.unique1 < i4.f1;;
SELECT ss1.d1 FROM tenk1 AS t1 INNER JOIN tenk1 AS t2 ON ((t1.tenthous = t2.ten)) INNER JOIN int8_tbl AS i8 LEFT JOIN int4_tbl AS i4 INNER JOIN (SELECT 64 AS d1 FROM tenk1 AS t3 , (SELECT (abs(t3.unique1) + random())) AS ss0(x) WHERE (t3.fivethous < 0)) AS ss1 ON ((i4.f1 = ss1.d1)) ON ((i8.q1 = i4.f1)) ON ((t1.tenthous = ss1.d1)) WHERE (t1.unique1 < i4.f1);
;
;
;
;
select ss1.d1 from
  tenk1 as t1
  inner join tenk1 as t2
  on t1.tenthous = t2.ten
  inner join
    int8_tbl as i8
    left join int4_tbl as i4
      inner join (select 64 as d1
                  from tenk1 t3,
                       lateral (select abs(t3.unique1) + random()) ss0(x)
                  where t3.fivethous < 0) as ss1
      on i4.f1 = ss1.d1
    on i8.q1 = i4.f1
  on t1.tenthous = ss1.d1
where t1.unique1 < i4.f1;;
select * from
  (select 1 as x) ss1 left join (select 2 as y) ss2 on (true),
  lateral (select ss2.y as z limit 1) ss3;;
select * from
  (select 1 as x) ss1 left join (select 2 as y) ss2 on (true),
  lateral (select ss2.y as z limit 1) ss3;;
;
select * from
  (select 1 as x) ss1 left join (select 2 as y) ss2 on (true),
  lateral (select ss2.y as z limit 1) ss3;;
SELECT * FROM (SELECT 1 AS x) AS ss1 LEFT JOIN (SELECT 2 AS y) AS ss2 ON (CAST('t' AS BOOLEAN)) , (SELECT ss2.y AS z LIMIT 1) AS ss3;
;
;
;
;
select * from
  (select 1 as x) ss1 left join (select 2 as y) ss2 on (true),
  lateral (select ss2.y as z limit 1) ss3;;
select * from
  (select 0 as z) as t1
  left join
  (select true as a) as t2
  on true,
  lateral (select true as b
           union all
           select a as b) as t3
where b;;
select * from
  (select 0 as z) as t1
  left join
  (select true as a) as t2
  on true,
  lateral (select true as b
           union all
           select a as b) as t3
where b;;
;
select * from
  (select 0 as z) as t1
  left join
  (select true as a) as t2
  on true,
  lateral (select true as b
           union all
           select a as b) as t3
where b;;
SELECT * FROM (SELECT 0 AS z) AS t1 LEFT JOIN (SELECT CAST('t' AS BOOLEAN) AS a) AS t2 ON (CAST('t' AS BOOLEAN)) , ((SELECT CAST('t' AS BOOLEAN) AS b) UNION ALL (SELECT a AS b)) AS t3 WHERE b;
;
;
;
;
select * from
  (select 0 as z) as t1
  left join
  (select true as a) as t2
  on true,
  lateral (select true as b
           union all
           select a as b) as t3
where b;;
select * from
  text_tbl t1
  left join int8_tbl i8
  on i8.q2 = 123,
  lateral (select i8.q1, t2.f1 from text_tbl t2 limit 1) as ss
where t1.f1 = ss.f1;;
select * from
  text_tbl t1
  left join int8_tbl i8
  on i8.q2 = 123,
  lateral (select i8.q1, t2.f1 from text_tbl t2 limit 1) as ss
where t1.f1 = ss.f1;;
;
select * from
  text_tbl t1
  left join int8_tbl i8
  on i8.q2 = 123,
  lateral (select i8.q1, t2.f1 from text_tbl t2 limit 1) as ss
where t1.f1 = ss.f1;;
SELECT * FROM text_tbl AS t1 LEFT JOIN int8_tbl AS i8 ON ((i8.q2 = 123)) , (SELECT i8.q1, t2.f1 FROM text_tbl AS t2 LIMIT 1) AS ss WHERE (t1.f1 = ss.f1);
;
;
;
select * from
  text_tbl t1
  left join int8_tbl i8
  on i8.q2 = 123,
  lateral (select i8.q1, t2.f1 from text_tbl t2 limit 1) as ss
where t1.f1 = ss.f1;;
select i8.*, ss.v, t.unique2
  from int8_tbl i8
    left join int4_tbl i4 on i4.f1 = 1
    left join lateral (select i4.f1 + 1 as v) as ss on true
    left join tenk1 t on t.unique2 = ss.v
where q2 = 456;;
select i8.*, ss.v, t.unique2
  from int8_tbl i8
    left join int4_tbl i4 on i4.f1 = 1
    left join lateral (select i4.f1 + 1 as v) as ss on true
    left join tenk1 t on t.unique2 = ss.v
where q2 = 456;;
;
select i8.*, ss.v, t.unique2
  from int8_tbl i8
    left join int4_tbl i4 on i4.f1 = 1
    left join lateral (select i4.f1 + 1 as v) as ss on true
    left join tenk1 t on t.unique2 = ss.v
where q2 = 456;;
SELECT i8.*, ss.v, t.unique2 FROM int8_tbl AS i8 LEFT JOIN int4_tbl AS i4 ON ((i4.f1 = 1)) LEFT JOIN (SELECT (i4.f1 + 1) AS v) AS ss ON (CAST('t' AS BOOLEAN)) LEFT JOIN tenk1 AS t ON ((t.unique2 = ss.v)) WHERE (q2 = 456);
;
;
;
;
select i8.*, ss.v, t.unique2
  from int8_tbl i8
    left join int4_tbl i4 on i4.f1 = 1
    left join lateral (select i4.f1 + 1 as v) as ss on true
    left join tenk1 t on t.unique2 = ss.v
where q2 = 456;;
select unique2, x.*
from tenk1 a, lateral (select * from int4_tbl b where f1 = a.unique1) x;;
select unique2, x.*
from tenk1 a, lateral (select * from int4_tbl b where f1 = a.unique1) x;;
;
select unique2, x.*
from tenk1 a, lateral (select * from int4_tbl b where f1 = a.unique1) x;;
SELECT unique2, x.* FROM tenk1 AS a , (SELECT * FROM int4_tbl AS b WHERE (f1 = a.unique1)) AS x;
;
;
;
;
select unique2, x.*
from tenk1 a, lateral (select * from int4_tbl b where f1 = a.unique1) x;;
select unique2, x.*
from int4_tbl x, lateral (select unique2 from tenk1 where f1 = unique1) ss;;
select unique2, x.*
from int4_tbl x, lateral (select unique2 from tenk1 where f1 = unique1) ss;;
;
select unique2, x.*
from int4_tbl x, lateral (select unique2 from tenk1 where f1 = unique1) ss;;
SELECT unique2, x.* FROM int4_tbl AS x , (SELECT unique2 FROM tenk1 WHERE (f1 = unique1)) AS ss;
;
;
;
;
select unique2, x.*
from int4_tbl x, lateral (select unique2 from tenk1 where f1 = unique1) ss;;
select unique2, x.*
from int4_tbl x left join lateral (select unique1, unique2 from tenk1 where f1 = unique1) ss on true
order by all;;
select unique2, x.*
from int4_tbl x left join lateral (select unique1, unique2 from tenk1 where f1 = unique1) ss on true
order by all;;
;
select unique2, x.*
from int4_tbl x left join lateral (select unique1, unique2 from tenk1 where f1 = unique1) ss on true
order by all;;
SELECT unique2, x.* FROM int4_tbl AS x LEFT JOIN (SELECT unique1, unique2 FROM tenk1 WHERE (f1 = unique1)) AS ss ON (CAST('t' AS BOOLEAN)) ORDER BY COLUMNS(*);
;
;
;
select unique2, x.*
from int4_tbl x left join lateral (select unique1, unique2 from tenk1 where f1 = unique1) ss on true
order by all;;
select * from generate_series(100,200) g(g),
  lateral (select * from int8_tbl a where g = q1 union all
           select * from int8_tbl b where g = q2) ss;;
select * from generate_series(100,200) g(g),
  lateral (select * from int8_tbl a where g = q1 union all
           select * from int8_tbl b where g = q2) ss;;
;
select * from generate_series(100,200) g(g),
  lateral (select * from int8_tbl a where g = q1 union all
           select * from int8_tbl b where g = q2) ss;;
SELECT * FROM generate_series(100, 200) AS g(g) , ((SELECT * FROM int8_tbl AS a WHERE (g = q1)) UNION ALL (SELECT * FROM int8_tbl AS b WHERE (g = q2))) AS ss;
;
;
;
;
select * from generate_series(100,200) g(g),
  lateral (select * from int8_tbl a where g = q1 union all
           select * from int8_tbl b where g = q2) ss;;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1)) ss(x) on b.unique2 = ss.x;;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1)) ss(x) on b.unique2 = ss.x;;
;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1)) ss(x) on b.unique2 = ss.x;;
SELECT count_star() FROM tenk1 AS a , tenk1 AS b INNER JOIN (SELECT * FROM (VALUES (a.unique1)) AS valueslist) AS ss(x) ON ((b.unique2 = ss.x));
;
;
;
;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1)) ss(x) on b.unique2 = ss.x;;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1),(-1)) ss(x) on b.unique2 = ss.x;;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1),(-1)) ss(x) on b.unique2 = ss.x;;
;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1),(-1)) ss(x) on b.unique2 = ss.x;;
SELECT count_star() FROM tenk1 AS a , tenk1 AS b INNER JOIN (SELECT * FROM (VALUES (a.unique1), (-1)) AS valueslist) AS ss(x) ON ((b.unique2 = ss.x));
;
;
;
;
select count(*) from tenk1 a,
  tenk1 b join lateral (values(a.unique1),(-1)) ss(x) on b.unique2 = ss.x;;
select * from (select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (select x) ss2(y);;
select * from (select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (select x) ss2(y);;
;
select * from (select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (select x) ss2(y);;
SELECT * FROM (SELECT (f1 / 2) AS x FROM int4_tbl) AS ss1 INNER JOIN int4_tbl AS i4 ON ((x = f1)) , (SELECT x) AS ss2(y);
;
;
;
;
select * from (select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (select x) ss2(y);;
select * from (select f1 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (values(x)) ss2(y);;
select * from (select f1 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (values(x)) ss2(y);;
;
select * from (select f1 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (values(x)) ss2(y);;
SELECT * FROM (SELECT f1 AS x FROM int4_tbl) AS ss1 INNER JOIN int4_tbl AS i4 ON ((x = f1)) , (SELECT * FROM (VALUES (x)) AS valueslist) AS ss2(y);
;
;
;
;
select * from (select f1 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1,
  lateral (values(x)) ss2(y);;
select * from ((select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1) j,
  lateral (select x) ss2(y);;
select * from ((select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1) j,
  lateral (select x) ss2(y);;
;
select * from ((select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1) j,
  lateral (select x) ss2(y);;
SELECT * FROM (SELECT * FROM (SELECT (f1 / 2) AS x FROM int4_tbl) AS ss1 INNER JOIN int4_tbl AS i4 ON ((x = f1))) AS j , (SELECT x) AS ss2(y);
;
;
;
;
select * from ((select f1/2 as x from int4_tbl) ss1 join int4_tbl i4 on x = f1) j,
  lateral (select x) ss2(y);;
select * from (values(1)) x(lb),
  lateral (values(lb)) y(lbcopy);;
select * from (values(1)) x(lb),
  lateral (values(lb)) y(lbcopy);;
;
select * from (values(1)) x(lb),
  lateral (values(lb)) y(lbcopy);;
SELECT * FROM (SELECT * FROM (VALUES (1)) AS valueslist) AS x(lb) , (SELECT * FROM (VALUES (lb)) AS valueslist) AS y(lbcopy);
;
;
;
;
select * from (values(1)) x(lb),
  lateral (values(lb)) y(lbcopy);;
select * from (values(1)) x(lb),
  lateral (select lb from int4_tbl) y(lbcopy);;
select * from (values(1)) x(lb),
  lateral (select lb from int4_tbl) y(lbcopy);;
;
select * from (values(1)) x(lb),
  lateral (select lb from int4_tbl) y(lbcopy);;
SELECT * FROM (SELECT * FROM (VALUES (1)) AS valueslist) AS x(lb) , (SELECT lb FROM int4_tbl) AS y(lbcopy);
;
;
;
;
select * from (values(1)) x(lb),
  lateral (select lb from int4_tbl) y(lbcopy);;
select x.* from
  int8_tbl x left join (select q1,coalesce(q2,0) q2 from int8_tbl) y on x.q2 = y.q1,
  lateral (select x.q1,y.q1,y.q2) v(xq1,yq1,yq2) order by 1, 2;;
select x.* from
  int8_tbl x left join (select q1,coalesce(q2,0) q2 from int8_tbl) y on x.q2 = y.q1,
  lateral (select x.q1,y.q1,y.q2) v(xq1,yq1,yq2) order by 1, 2;;
;
select x.* from
  int8_tbl x left join (select q1,coalesce(q2,0) q2 from int8_tbl) y on x.q2 = y.q1,
  lateral (select x.q1,y.q1,y.q2) v(xq1,yq1,yq2) order by 1, 2;;
SELECT x.* FROM int8_tbl AS x LEFT JOIN (SELECT q1, COALESCE(q2, 0) AS q2 FROM int8_tbl) AS y ON ((x.q2 = y.q1)) , (SELECT x.q1, y.q1, y.q2) AS v(xq1, yq1, yq2) ORDER BY 1, 2;
;
;
;
select x.* from
  int8_tbl x left join (select q1,coalesce(q2,0) q2 from int8_tbl) y on x.q2 = y.q1,
  lateral (select x.q1,y.q1,y.q2) v(xq1,yq1,yq2) order by 1, 2;;
select 1 from tenk1 a, lateral (select max(a.unique1) from int4_tbl b) ss;;
select 1 from tenk1 a, lateral (select max(a.unique1) from int4_tbl b) ss;;
;
select 1 from tenk1 a, lateral (select max(a.unique1) from int4_tbl b) ss;;
select 1 from tenk1 a, lateral (select max(a.unique1) from int4_tbl b) ss;;
create table xx1 as select f1 as x1, -f1 as x2 from int4_tbl;;
select * from xx1;;
select * from xx1;;
;
select * from xx1;;
SELECT * FROM xx1;
;
;
;
;
select * from xx1;;
update xx1 set x2 = f1 from (select * from int4_tbl where f1 = x1) ss;;
update xx1 set x2 = f1 from (select * from int4_tbl where f1 = xx1.x1) ss;;
update xx1 set x2 = f1 from lateral (select * from int4_tbl where f1 = x1) ss;;
update xx1 set x2 = f1 from xx1 AS xx2, lateral (select * from int4_tbl where f1 = xx2.x1 AND f1=-2147483647) ss;;
select * from xx1;;
select * from xx1;;
;
select * from xx1;;
SELECT * FROM xx1;
;
;
;
;
select * from xx1;;
delete from xx1 using (select * from int4_tbl where f1 = x1) ss;;
delete from xx1 using (select * from int4_tbl where f1 = xx1.x1) ss;;
delete from xx1 using lateral (select * from int4_tbl where f1 = x1) ss;;
