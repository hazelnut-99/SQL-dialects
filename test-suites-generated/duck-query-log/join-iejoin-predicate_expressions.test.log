PRAGMA enable_verification;
create table calendar as SELECT *
FROM range(DATE '2022-01-01', DATE '2024-02-01', INTERVAL '1' MONTH);;
create table scd2 as 
select 
  range as range_start,
  case when date_part('year', range) < 2023 then range + interval 4 month - interval 1 day end as range_end,
  n
from calendar
cross join generate_series(1, 85) as n;
create table scd2_non_null as 
select 
  range as range_start,
  case when date_part('year', range) < 2023 then range + interval 4 month - interval 1 day else '2099-01-01' end as range_end,
  n
from calendar
cross join generate_series(1, 85) as n;
select
    range,
    count(*) as n
from scd2_non_null
inner join calendar
    on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
select
    range,
    count(*) as n
from scd2_non_null
inner join calendar
    on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
;
select
    range,
    count(*) as n
from scd2_non_null
inner join calendar
    on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
SELECT "range", count_star() AS n FROM scd2_non_null INNER JOIN calendar ON (("range" BETWEEN range_start AND COALESCE(range_end, '2099-01-01'))) GROUP BY "range" ORDER BY "range";
;
;
;
;
select
    range,
    count(*) as n
from scd2_non_null
inner join calendar
    on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range <= ifnull(range_end,'2099-01-01') and range_start <= range
group by range
order by range;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range <= ifnull(range_end,'2099-01-01') and range_start <= range
group by range
order by range;
;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range <= ifnull(range_end,'2099-01-01') and range_start <= range
group by range
order by range;
SELECT "range", count_star() AS n FROM scd2 INNER JOIN calendar ON ((("range" <= COALESCE(range_end, '2099-01-01')) AND (range_start <= "range"))) GROUP BY "range" ORDER BY "range";
;
;
;
;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range <= ifnull(range_end,'2099-01-01') and range_start <= range
group by range
order by range;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
SELECT "range", count_star() AS n FROM scd2 INNER JOIN calendar ON (("range" BETWEEN range_start AND COALESCE(range_end, '2099-01-01'))) GROUP BY "range" ORDER BY "range";
;
;
;
;
select
	range,
	count(*) as n
from scd2
inner join calendar
		on range between range_start and ifnull(range_end,'2099-01-01')
group by range
order by range;
