PRAGMA enable_verification;
create or replace table test1 as (
    select 'new_customers' as child, 'dim_model_7' as parent
    union all select 'exposure_1' as child, 'dim_model_7' as parent
    union all select 'exposure_1' as child, 'exposure_1' as parent
    union all select 'fct_model_6' as child, 'fct_model_6' as parent
    union all select 'exposure_1' as child, 'fct_model_6' as parent
    union all select 'report_1' as child, 'fct_model_6' as parent
    union all select 'report_2' as child, 'fct_model_6' as parent
    union all select 'report_3' as child, 'fct_model_6' as parent
    union all select 'fct_model_9' as child, 'fct_model_9' as parent
    union all select 'stg_model_5' as child, 'fct_model_9' as parent
    union all select 'int_model_4' as child, 'int_model_4' as parent
    union all select 'int_model_5' as child, 'int_model_4' as parent
    union all select 'dim_model_7' as child, 'int_model_4' as parent
    union all select 'new_customers' as child, 'int_model_4' as parent
    union all select 'exposure_1' as child, 'int_model_4' as parent
    union all select 'int_model_5' as child, 'int_model_5' as parent
    union all select 'dim_model_7' as child, 'int_model_5' as parent
    union all select 'new_customers' as child, 'int_model_5' as parent
    union all select 'exposure_1' as child, 'int_model_5' as parent
    union all select 'model_8' as child, 'model_8' as parent
    union all select 'new_customers' as child, 'new_customers' as parent
    union all select 'report_1' as child, 'report_1' as parent
    union all select 'report_2' as child, 'report_2' as parent
    union all select 'report_3' as child, 'report_3' as parent
);;
select
    child,
    count(*) as cnt,
    list_sort(
        list(
            parent
        )
    )
    as source_parents
from test1
group by 1
having cnt > 1;;
select
    child,
    count(*) as cnt,
    list_sort(
        list(
            parent
        )
    )
    as source_parents
from test1
group by 1
having cnt > 1;;
;
select
    child,
    count(*) as cnt,
    list_sort(
        list(
            parent
        )
    )
    as source_parents
from test1
group by 1
having cnt > 1;;
SELECT child, count_star() AS cnt, list_sort(list(parent)) AS source_parents FROM test1 GROUP BY 1 HAVING (cnt > 1);
;
;
;
select
    child,
    count(*) as cnt,
    list_sort(
        list(
            parent
        )
    )
    as source_parents
from test1
group by 1
having cnt > 1;;
