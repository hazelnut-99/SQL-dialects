PRAGMA enable_verification;
CREATE TABLE test_tbl (id INT, name string);;
CREATE TABLE test2_tbl (id INT, name string);;
CREATE TABLE greek_tbl (id INT, name string);;
INSERT INTO test_tbl VALUES (1,'tom'), (2,'dick'),(3,'harry'), (4,'mary'), (5,'mungo'), (6,'midge');  ;
INSERT INTO test_tbl VALUES (20,'andrew'), (21,'boris'),(22,'Caleb'), (23,'david'), (24,'evan');;
INSERT INTO  greek_tbl VALUES (1, 'alpha'), (2, 'beta'), (3, 'gamma'), (4, 'delta'), (5, 'epsilon'),(6, 'zeta'), (7, 'eta') , (8, 'theta'), (9, 'iota') , (10, 'kappa'); ;
CREATE  MACRO xt(a,_name) as TABLE SELECT * FROM test_tbl WHERE(id>=a or name=_name);;
CREATE  MACRO xt2(a,_name) as TABLE SELECT * FROM test_tbl WHERE(id>=a or name like _name);;
CREATE  MACRO sgreek(a,b,c) as TABLE SELECT a,b FROM greek_tbl WHERE(id >= c);;
( SELECT* FROM xt(1, 'tom') UNION SELECT* FROM  xt2(1, '%%%') ) INTERSECT SELECT* FROM xt(100,'midge');;
( SELECT* FROM xt(1, 'tom') UNION SELECT* FROM  xt2(1, '%%%') ) INTERSECT SELECT* FROM xt(100,'midge');;
;
( SELECT* FROM xt(1, 'tom') UNION SELECT* FROM  xt2(1, '%%%') ) INTERSECT SELECT* FROM xt(100,'midge');;
((SELECT * FROM xt(1, 'tom')) UNION (SELECT * FROM xt2(1, '%%%'))) INTERSECT (SELECT * FROM xt(100, 'midge'));
;
;
;
;
( SELECT* FROM xt(1, 'tom') UNION SELECT* FROM  xt2(1, '%%%') ) INTERSECT SELECT* FROM xt(100,'midge');;
(SELECT* FROM xt(1, 'tom') EXCEPT SELECT* FROM xt(20,'tom' )) INTERSECT SELECT* FROM xt(100,'harry');;
(SELECT* FROM xt(1, 'tom') EXCEPT SELECT* FROM xt(20,'tom' )) INTERSECT SELECT* FROM xt(100,'harry');;
;
(SELECT* FROM xt(1, 'tom') EXCEPT SELECT* FROM xt(20,'tom' )) INTERSECT SELECT* FROM xt(100,'harry');;
((SELECT * FROM xt(1, 'tom')) EXCEPT (SELECT * FROM xt(20, 'tom'))) INTERSECT (SELECT * FROM xt(100, 'harry'));
;
;
;
;
(SELECT* FROM xt(1, 'tom') EXCEPT SELECT* FROM xt(20,'tom' )) INTERSECT SELECT* FROM xt(100,'harry');;
SELECT	* FROM  xt(200,'andrew');;
SELECT	* FROM  xt(200,'andrew');;
;
SELECT	* FROM  xt(200,'andrew');;
SELECT * FROM xt(200, 'andrew');
;
;
;
;
SELECT	* FROM  xt(200,'andrew');;
SELECT * FROM xt2(100,'m%');;
SELECT * FROM xt2(100,'m%');;
;
SELECT * FROM xt2(100,'m%');;
SELECT * FROM xt2(100, 'm%');
;
;
;
;
SELECT * FROM xt2(100,'m%');;
CREATE  MACRO xtm(cmp_str) as TABLE SELECT id, name FROM test_tbl  WHERE( name similar to cmp_str);;
SELECT * FROM xtm('m.*');;
SELECT * FROM xtm('m.*');;
;
SELECT * FROM xtm('m.*');;
SELECT * FROM xtm('m.*');
;
;
;
;
SELECT * FROM xtm('m.*');;
CREATE  MACRO  xt_reg(cmp) as TABLE SELECT * FROM test_tbl WHERE regexp_matches(name ,cmp );;
SELECT * FROM xt_reg('^m');;
SELECT * FROM xt_reg('^m');;
;
SELECT * FROM xt_reg('^m');;
SELECT * FROM xt_reg('^m');
;
;
;
;
SELECT * FROM xt_reg('^m');;
CREATE MACRO   cmp(a,m) as regexp_matches(a,m) or a similar to m;;
CREATE  MACRO gm(m) as TABLE SELECT * FROM  greek_tbl WHERE cmp(name,m);;
SELECT * FROM  gm('^m');;
SELECT * FROM  gm('^m');;
;
SELECT * FROM  gm('^m');;
SELECT * FROM gm('^m');
;
;
;
;
SELECT * FROM  gm('^m');;
CREATE MACRO xt(a,b) as a+b;;
DROP MACRO TABLE xt;;
CREATE MACRO xt(id, imax) as TABLE SELECT id,name FROM test_tbl WHERE id<=imax;;
SELECT * FROM xt(id,1);;
SELECT * FROM xt(id,1);;
;
SELECT * FROM xt(id,1);;
SELECT * FROM xt(id, 1);
;
;
;
;
SELECT * FROM xt(id,1);;
CREATE  MACRO range(a,b) as TABLE select a,b from test_tbl;;
SELECT * FROM test_tbl where id>=(SELECT max(id) FROM xt(id,30));;
SELECT * FROM test_tbl where id>=(SELECT max(id) FROM xt(id,30));;
;
SELECT * FROM test_tbl where id>=(SELECT max(id) FROM xt(id,30));;
SELECT * FROM test_tbl WHERE (id >= (SELECT max(id) FROM xt(id, 30)));
;
;
;
;
SELECT * FROM test_tbl where id>=(SELECT max(id) FROM xt(id,30));;
SELECT * FROM greek_tbl where id<=(SELECT min(id) FROM xt(id,30));;
SELECT * FROM greek_tbl where id<=(SELECT min(id) FROM xt(id,30));;
;
SELECT * FROM greek_tbl where id<=(SELECT min(id) FROM xt(id,30));;
SELECT * FROM greek_tbl WHERE (id <= (SELECT min(id) FROM xt(id, 30)));
;
;
;
;
SELECT * FROM greek_tbl where id<=(SELECT min(id) FROM xt(id,30));;
SELECT schema_name, function_name, function_type, description, return_type, parameters, parameter_types, varargs, macro_definition FROM duckdb_functions() WHERE function_type = 'table_macro' AND
 ( function_name = 'sgreek' or  function_name = 'xt') order by function_name;;
SELECT schema_name, function_name, function_type, description, return_type, parameters, parameter_types, varargs, macro_definition FROM duckdb_functions() WHERE function_type = 'table_macro' AND
 ( function_name = 'sgreek' or  function_name = 'xt') order by function_name;;
;
SELECT schema_name, function_name, function_type, description, return_type, parameters, parameter_types, varargs, macro_definition FROM duckdb_functions() WHERE function_type = 'table_macro' AND
 ( function_name = 'sgreek' or  function_name = 'xt') order by function_name;;
SELECT schema_name, function_name, function_type, description, return_type, parameters, parameter_types, varargs, macro_definition FROM duckdb_functions() WHERE ((function_type = 'table_macro') AND ((function_name = 'sgreek') OR (function_name = 'xt'))) ORDER BY function_name;
;
;
;
;
SELECT schema_name, function_name, function_type, description, return_type, parameters, parameter_types, varargs, macro_definition FROM duckdb_functions() WHERE function_type = 'table_macro' AND
 ( function_name = 'sgreek' or  function_name = 'xt') order by function_name;;
